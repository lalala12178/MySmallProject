<!doctype html>
<html class="fixed" xmlns:th="http://www.w3.org/1999/xhtml">
	<head>

		<!-- Basic -->
		<meta charset="UTF-8">

		<title>已完成订单</title>
		<meta name="keywords" content="HTML5 Admin Template" />
		<meta name="description" content="Porto Admin - Responsive HTML5 Template">
		<meta name="author" content="okler.net">

		<!-- Mobile Metas -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

		<!-- Web Fonts  -->
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800|Shadows+Into+Light" rel="stylesheet" type="text/css">

		<!-- Vendor CSS -->
		<link rel="stylesheet" href="assets/vendor/bootstrap/css/bootstrap.css" />
		<link rel="stylesheet" href="assets/vendor/font-awesome/css/font-awesome.css" />
		<link rel="stylesheet" href="assets/vendor/magnific-popup/magnific-popup.css" />
		<link rel="stylesheet" href="assets/vendor/bootstrap-datepicker/css/datepicker3.css" />

		<!-- Specific Page Vendor CSS -->
		<link rel="stylesheet" href="assets/vendor/select2/select2.css" />
		<link rel="stylesheet" href="assets/vendor/jquery-datatables-bs3/assets/css/datatables.css" />

		<!-- Theme CSS -->
		<link rel="stylesheet" href="assets/stylesheets/theme.css" />

		<!-- Skin CSS -->
		<link rel="stylesheet" href="assets/stylesheets/skins/default.css" />

		<!-- Theme Custom CSS -->
		<link rel="stylesheet" href="assets/stylesheets/theme-custom.css">

		<!-- Head Libs -->
		<script src="assets/vendor/modernizr/modernizr.js"></script>

	</head>
	<body>
		<section class="body">

			<!-- start: header -->
			<header class="header">
				<div class="logo-container">
					<a href"/user/index" class="logo">
						<img src="assets/images/logo.png" height="35" alt="Porto Admin" />
					</a>
					<div class="visible-xs toggle-sidebar-left" data-toggle-class="sidebar-left-opened" data-target="html" data-fire-event="sidebar-left-opened">
						<i class="fa fa-bars" aria-label="Toggle sidebar"></i>
					</div>
				</div>
			
				<!-- start: search & user box -->
				<div class="header-right">
			

			
					<span class="separator"></span>

					<ul class="notifications">
						<li>
							<a href="#" class="dropdown-toggle notification-icon" data-toggle="dropdown">
								<i class="fa fa-tasks"></i>
								<span class="badge"></span>
							</a>

							<div class="dropdown-menu notification-menu large">
								<div class="notification-title">
									<span class="pull-right label label-default"></span>
									今日任务
								</div>

								<div class="content">
									<ul>
										<li>
											<p class="clearfix mb-xs">
												<span class="message pull-left">编写日报</span>
												<span class="message pull-right text-dark">60%</span>
											</p>
											<div class="progress progress-xs light">
												<div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;"></div>
											</div>
										</li>

										<li>
											<p class="clearfix mb-xs">
												<span class="message pull-left">资料整理</span>
												<span class="message pull-right text-dark">98%</span>
											</p>
											<div class="progress progress-xs light">
												<div class="progress-bar" role="progressbar" aria-valuenow="98" aria-valuemin="0" aria-valuemax="100" style="width: 98%;"></div>
											</div>
										</li>

										<li>
											<p class="clearfix mb-xs">
												<span class="message pull-left">面试进度</span>
												<span class="message pull-right text-dark">33%</span>
											</p>
											<div class="progress progress-xs light mb-xs">
												<div class="progress-bar" role="progressbar" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100" style="width: 33%;"></div>
											</div>
										</li>
									</ul>
								</div>
							</div>
						</li>
						<li>
							<a href="#" class="dropdown-toggle notification-icon" data-toggle="dropdown">
								<i class="fa fa-envelope"></i>
								<span class="badge"></span>
							</a>

							<div class="dropdown-menu notification-menu">
								<div class="notification-title">
									<span class="pull-right label label-default">3</span>
									消息
								</div>

								<div class="content">
									<ul>
										<li>
											<a href="#" class="clearfix">
												<figure class="image">
													<img src="assets/images/!sample-user.jpg" alt="Joseph Doe Junior" class="img-circle" />
												</figure>
												<span class="title">张三</span>
												<span class="message">面试我吧。</span>
											</a>
										</li>
										<li>
											<a href="#" class="clearfix">
												<figure class="image">
													<img src="assets/images/!sample-user.jpg" alt="Joseph Junior" class="img-circle" />
												</figure>
												<span class="title">李四</span>
												<span class="message truncate">面试我吧。</span>
											</a>
										</li>
										<li>
											<a href="#" class="clearfix">
												<figure class="image">
													<img src="assets/images/!sample-user.jpg" alt="Joe Junior" class="img-circle" />
												</figure>
												<span class="title">王五</span>
												<span class="message">面试我吧。</span>
											</a>
										</li>

									</ul>

									<hr />


								</div>
							</div>
						</li>
						<li>
							<a href="#" class="dropdown-toggle notification-icon" data-toggle="dropdown">
								<i class="fa fa-bell"></i>
								<span class="badge"></span>
							</a>

							<div class="dropdown-menu notification-menu">
								<div class="notification-title">
									<span class="pull-right label label-default">3</span>
									警报
								</div>

								<div class="content">
									<ul>
										<li>
											<a href="#" class="clearfix">
												<div class="image">
													<i class="fa fa-thumbs-down bg-danger"></i>
												</div>
												<span class="title">严重警报</span>
												<span class="message">刚刚</span>
											</a>
										</li>
										<li>
											<a href="#" class="clearfix">
												<div class="image">
													<i class="fa fa-lock bg-warning"></i>
												</div>
												<span class="title">警报</span>
												<span class="message">15分钟前</span>
											</a>
										</li>
										<li>
											<a href="#" class="clearfix">
												<div class="image">
													<i class="fa fa-signal bg-success"></i>
												</div>
												<span class="title">记录日志</span>
												<span class="message">2020/3/17</span>
											</a>
										</li>
									</ul>

									<hr />


								</div>
							</div>
						</li>
					</ul>
			
					<span class="separator"></span>

					<div id="userbox" class="userbox">
						<a href="#" data-toggle="dropdown">
							<figure class="profile-picture">
								<img src="assets/images/!logged-user.jpg" alt="Joseph Doe" class="img-circle" data-lock-picture="assets/images/!logged-user.jpg" />
							</figure>
							<div class="profile-info" data-lock-name="yuchenjiang" data-lock-email="379298265@qq.com">
								<span class="name" th:text="${session.username}"></span>
								<span class="role" th:text="${session.ChiRole}"></span>
							</div>

							<i class="fa custom-caret"></i>
						</a>

						<div class="dropdown-menu">
							<ul class="list-unstyled">
								<li class="divider"></li>

								<li>
									<a role="menuitem" tabindex="-1" href="/user/login"><i class="fa fa-power-off"></i> Logout</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
				<!-- end: search & user box -->
			</header>
			<!-- end: header -->

			<div class="inner-wrapper">
				<!-- start: sidebar -->
				<aside id="sidebar-left" class="sidebar-left">

					<div class="sidebar-header">
						<div class="sidebar-title">
							Navigation
						</div>
						<div class="sidebar-toggle hidden-xs" data-toggle-class="sidebar-left-collapsed" data-target="html" data-fire-event="sidebar-left-toggle">
							<i class="fa fa-bars" aria-label="Toggle sidebar"></i>
						</div>
					</div>

					<div class="nano">
						<div class="nano-content">
							<nav id="menu" class="nav-main" role="navigation">
								<ul class="nav nav-main">
									<li class="nav-active">
										<a href="index.html">
											<i class="fa fa-home" aria-hidden="true"></i>
											<span>主页</span>
										</a>
									</li>
									<li class="nav-parent" th:if="${session.userRole}!='operator'">
										<a>
											<i class="fa fa-copy" aria-hidden="true" ></i>
											<span>人员管理</span>
										</a>
										<ul class="nav nav-children">
											<li th:if="${session.userRole}=='root'">
												<a href="/user/humanAffairsRole">
													权限管理
												</a>
											</li>
											<li>
												<a href="/user/humanAffairsMoney">
													薪水管理
												</a>
											</li>
										</ul>
									</li>
									<li class="nav-parent nav-expanded" th:if="${session.userRole}!='pm'">
										<a>
											<i class="fa fa-tasks" aria-hidden="true"></i>
											<span>订单管理</span>
										</a>
										<ul class="nav nav-children">
											<li class="nav-active">
												<a href="/order/orderManagementFine">
													已完成订单
												</a>
											</li>
											<li>
												<a href="/order/orderManagementGo">
													待处理订单
												</a>
											</li>

										</ul>
									</li>
									<li class="nav-parent">
										<a>
											<i class="fa fa-list-alt" aria-hidden="true"></i>
											<span>其他</span>
										</a>
										<ul class="nav nav-children">
											<li>
												<a href="#">
													其余功能正在开发
												</a>
											</li>
										</ul>
									</li>
									<li>
										<a href="/user/mailbox-compose">
											<span class="pull-right label label-primary"></span>
											<i class="fa fa-envelope" aria-hidden="true"></i>
											<span>邮箱</span>
										</a>
									</li>
								</ul>
							</nav>

							<hr class="separator" />

						</div>

					</div>

				</aside>
				<!-- end: sidebar -->

				<section role="main" class="content-body">
					<header class="page-header">
						<h2>已完成订单</h2>
					
						<div class="right-wrapper pull-right">
							<ol class="breadcrumbs">
								<li>
									<a href="index.html">
										<i class="fa fa-home"></i>
									</a>
								</li>
								<li><span>已完成订单</span></li>
							</ol>
					
							<a class="sidebar-right-toggle" data-open="sidebar-right"><i class="fa fa-chevron-left"></i></a>
						</div>
					</header>

					<!-- start: page -->
						<section class="panel">
							<header class="panel-heading">
								<div class="panel-actions">
									<a href="#" class="fa fa-caret-down"></a>
									<a href="#" class="fa fa-times"></a>
								</div>
						
								<h2 class="panel-title">已完成订单</h2>
							</header>
							<div class="panel-body">
								<table class="table table-bordered table-striped mb-none" id="datatable-editable">
									<thead>
										<tr>
											<th>订单名</th>
											<th>数量</th>
											<th>操作员</th>
											<th>最后修改时间</th>
											<th style="display: none">id</th>
											<th >操作</th>
<!--											<th>id</th>-->
										</tr>
									</thead>
									<tbody>
										<tr class="gradeX" th:each="u,var:${listRole}">
											<td th:text="${u.orderName}"></td>
											<td th:text="${u.quantity}"></td>
											<td th:text="${u.operator}"></td>
											<td th:text="${u.orderDate}"></td>
											<td th:text="${u.id}" style="display: none"></td>
											<td class="actions">
												<a  class="hidden on-editing save-row" ><i class="fa fa-save"></i></a>
												<a href="#" class="hidden on-editing cancel-row"><i class="fa fa-times"></i></a>
												<a href="#" class="on-default edit-row" th:if="${session.userRole}!='operator'"><i class="fa fa-pencil"></i></a>
												<a href="#" class="on-default remove-row" th:if="${session.userRole}!='operator'"><i class="fa fa-trash-o"></i></a>
											</td>
										</tr>

									</tbody>
								</table>
							</div>
						</section>
					<!-- end: page -->
				</section>
			</div>

			<aside id="sidebar-right" class="sidebar-right">
				<div class="nano">
					<div class="nano-content">
						<a href="#" class="mobile-close visible-xs">
							Collapse <i class="fa fa-chevron-right"></i>
						</a>
			
						<div class="sidebar-right-wrapper">
			
							<div class="sidebar-widget widget-calendar">
								<h6>Upcoming Tasks</h6>
								<div data-plugin-datepicker data-plugin-skin="dark" ></div>
			
								<ul>
									<li>
										<time datetime="2014-04-19T00:00+00:00">04/19/2014</time>
										<span>Company Meeting</span>
									</li>
								</ul>
							</div>
			
							<div class="sidebar-widget widget-friends">
								<h6>Friends</h6>
								<ul>
									<li class="status-online">
										<figure class="profile-picture">
											<img src="assets/images/!sample-user.jpg" alt="Joseph Doe" class="img-circle">
										</figure>
										<div class="profile-info">
											<span class="name">Joseph Doe Junior</span>
											<span class="title">Hey, how are you?</span>
										</div>
									</li>
									<li class="status-online">
										<figure class="profile-picture">
											<img src="assets/images/!sample-user.jpg" alt="Joseph Doe" class="img-circle">
										</figure>
										<div class="profile-info">
											<span class="name">Joseph Doe Junior</span>
											<span class="title">Hey, how are you?</span>
										</div>
									</li>
									<li class="status-offline">
										<figure class="profile-picture">
											<img src="assets/images/!sample-user.jpg" alt="Joseph Doe" class="img-circle">
										</figure>
										<div class="profile-info">
											<span class="name">Joseph Doe Junior</span>
											<span class="title">Hey, how are you?</span>
										</div>
									</li>
									<li class="status-offline">
										<figure class="profile-picture">
											<img src="assets/images/!sample-user.jpg" alt="Joseph Doe" class="img-circle">
										</figure>
										<div class="profile-info">
											<span class="name">Joseph Doe Junior</span>
											<span class="title">Hey, how are you?</span>
										</div>
									</li>
								</ul>
							</div>
			
						</div>
					</div>
				</div>
			</aside>
		</section>

		<div id="dialog" class="modal-block mfp-hide">
			<section class="panel">
				<header class="panel-heading">
					<h2 class="panel-title">确认</h2>
				</header>
				<div class="panel-body">
					<div class="modal-wrapper">
						<div class="modal-text">
							<p>确定要删除此工单信息？</p>
						</div>
					</div>
				</div>
				<footer class="panel-footer">
					<div class="row">
						<div class="col-md-12 text-right">
							<button id="dialogConfirm" class="btn btn-primary">Confirm</button>
							<button id="dialogCancel" class="btn btn-default">Cancel</button>
						</div>
					</div>
				</footer>
			</section>
		</div>

		<!-- Vendor -->
		<script src="assets/vendor/jquery/jquery.js"></script>
		<script src="assets/vendor/jquery-browser-mobile/jquery.browser.mobile.js"></script>
		<script src="assets/vendor/bootstrap/js/bootstrap.js"></script>
		<script src="assets/vendor/nanoscroller/nanoscroller.js"></script>
		<script src="assets/vendor/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
		<script src="assets/vendor/magnific-popup/magnific-popup.js"></script>
		<script src="assets/vendor/jquery-placeholder/jquery.placeholder.js"></script>
		
		<!-- Specific Page Vendor -->
		<script src="assets/vendor/select2/select2.js"></script>
		<script src="assets/vendor/jquery-datatables/media/js/jquery.dataTables.js"></script>
		<script src="assets/vendor/jquery-datatables-bs3/assets/js/datatables.js"></script>
		
		<!-- Theme Base, Components and Settings -->
		<script src="assets/javascripts/theme.js"></script>
		
		<!-- Theme Custom -->
		<script src="assets/javascripts/theme.custom.js"></script>
		
		<!-- Theme Initialization Files -->
		<script src="assets/javascripts/theme.init.js"></script>


		<!-- Examples -->
		<script type="text/javascript">


			(function( $ ) {

				'use strict';

				var EditableTable = {

					options: {
						addButton: '#addToTable',
						table: '#datatable-editable',
						dialog: {
							wrapper: '#dialog',
							cancelButton: '#dialogCancel',
							confirmButton: '#dialogConfirm',
						}
					},

					initialize: function() {
						this
								.setVars()
								.build()
								.events();
					},

					setVars: function() {
						this.$table				= $( this.options.table );
						this.$addButton			= $( this.options.addButton );

						// dialog
						this.dialog				= {};
						this.dialog.$wrapper	= $( this.options.dialog.wrapper );
						this.dialog.$cancel		= $( this.options.dialog.cancelButton );
						this.dialog.$confirm	= $( this.options.dialog.confirmButton );

						return this;
					},

					build: function() {
						this.datatable = this.$table.DataTable({
							aoColumns: [
								null,
								null,
								null,
								null,
								null,
								{ "bSortable": false }
							]
						});

						window.dt = this.datatable;

						return this;
					},

					events: function() {
						var _self = this;

						this.$table
								.on('click', 'a.save-row', function( e ) {
									e.preventDefault();





									_self.rowSave( $(this).closest( 'tr' ) );
								})
								.on('click', 'a.cancel-row', function( e ) {
									e.preventDefault();

									_self.rowCancel( $(this).closest( 'tr' ) );
								})
								.on('click', 'a.edit-row', function( e ) {
									e.preventDefault();

									_self.rowEdit( $(this).closest( 'tr' ) );
								})
								.on( 'click', 'a.remove-row', function( e ) {
									e.preventDefault();

									var $row = $(this).closest( 'tr' );

									$.magnificPopup.open({
										items: {
											src: '#dialog',
											type: 'inline'
										},
										preloader: false,
										modal: true,
										callbacks: {
											change: function() {
												_self.dialog.$confirm.on( 'click', function( e ) {
													e.preventDefault();

													_self.rowRemove( $row );
													$.magnificPopup.close();
												});
											},
											close: function() {
												_self.dialog.$confirm.off( 'click' );
											}
										}
									});
								});

						this.$addButton.on( 'click', function(e) {
							e.preventDefault();

							_self.rowAdd();
						});

						this.dialog.$cancel.on( 'click', function( e ) {
							e.preventDefault();
							$.magnificPopup.close();
						});

						return this;
					},

					// ==========================================================================================
					// ROW FUNCTIONS
					// ==========================================================================================
					rowAdd: function() {
						this.$addButton.attr({ 'disabled': 'disabled' });

						var actions,
								data,
								$row;

						actions = [
							'<a href="#" class="hidden on-editing save-row" th:if="${session.userRole}!=\'operator\'"><i class="fa fa-save"></i></a>',
							'<a href="#" class="hidden on-editing cancel-row"th:if="${session.userRole}!=\'operator\'"><i class="fa fa-times"></i></a>',
							'<a href="#" class="on-default edit-row" th:if="${session.userRole}==\'operator\'"><i class="fa fa-pencil"></i></a>',
							'<a href="#" class="on-default remove-row" th:if="${session.userRole}==\'operator\'"><i class="fa fa-trash-o"></i></a>'
						].join(' ');

						data = this.datatable.row.add([ '', '','', '','', actions ]);
						$row = this.datatable.row( data[0] ).nodes().to$();

						$row
								.addClass( 'adding' )
								.find( 'td:last' )
								.addClass( 'actions' );

						this.rowEdit( $row );

						this.datatable.order([0,'asc']).draw(); // always show fields
					},

					rowCancel: function( $row ) {
						var _self = this,
								$actions,
								i,
								data;

						if ( $row.hasClass('adding') ) {
							this.rowRemove( $row );
						} else {

							data = this.datatable.row( $row.get(0) ).data();
							this.datatable.row( $row.get(0) ).data( data );

							$actions = $row.find('td.actions');
							if ( $actions.get(0) ) {
								this.rowSetActionsDefault( $row );
							}

							this.datatable.draw();
						}
					},

					rowEdit: function( $row ) {
						var _self = this,
								data;

						data = this.datatable.row( $row.get(0) ).data();

						$row.children( 'td' ).each(function( i ) {
							var $this = $( this );

							if (data[4]==""){
								data[4]=0;
								data[2]="[[${session.username}]]";
							}


							if ( $this.hasClass('actions') ) {
								_self.rowSetActionsEditing( $row );
							}else if(i==2){
								$this.html( '<input  required="required" type="text" readonly="readonly" class="form-control input-block" value="' +   data[i]  + '"/>' );

							}else if(i==3){
								$this.html( '<input required="required" type="text" readonly="readonly" class="form-control input-block" value="' +   data[i]  + '"/>' );

							}else if(i==4){
								$this.html( '<input required="required" type="text" class="form-control input-block" value="' + data[i] + '"/>' );
								$this.hide();
							}else {
								$this.html( '<input required="required" type="text" class="form-control input-block" value="' + data[i] + '"/>' );
							}
						});
					},

					rowSave: function( $row ) {
						var _self     = this,
								$actions,
								gobackMSG,htmlobj,
								values    = [];

						if ( $row.hasClass( 'adding' ) ) {
							this.$addButton.removeAttr( 'disabled' );
							$row.removeClass( 'adding' );
						}

						values = $row.find('td').map(function() {
							var $this = $(this);

							if ( $this.hasClass('actions') ) {
								_self.rowSetActionsDefault( $row );
								return _self.datatable.cell( this ).data();
							} else {
								return $.trim( $this.find('input').val() );
							}
						});
						console.log(sessionStorage.username);
						// console.log([[${session.username}]]);


							values[2]="[[${session.username}]]";

						console.log(values)

						gobackMSG="orderName="+values[0]+"&quantity="+values[1]+"&operator="+values[2]+"&id="+values[4]+"&state="+2;


						var a =$.ajax({
							async:false,
							type: "POST",
							url: "/order/orderSheetChange",
							data: gobackMSG,
							dataType: "json",
							success: function have(result) {

								htmlobj=result;

							},
						});
						values[4]=htmlobj.id;
						values[3]=htmlobj.orderDate;

						this.datatable.row( $row.get(0) ).data( values );


						$actions = $row.find('td.actions');
						if ( $actions.get(0) ) {
							this.rowSetActionsDefault( $row );
						}

						this.datatable.draw();




					},

					rowRemove: function( $row ) {
						var id    = [],gobackMSG,tempObject;
						if ( $row.hasClass('adding') ) {
							this.$addButton.removeAttr( 'disabled' );
						}

						tempObject=this.datatable.row($row.get(0)).selector.rows.children;

						gobackMSG="id="+tempObject[4].innerHTML;
						console.log(gobackMSG);

						$.ajax({
							type: "POST",
							url: "/order/delUser",
							data: gobackMSG,
						});
						this.datatable.row( $row.get(0) ).remove().draw();
					},

					rowSetActionsEditing: function( $row ) {
						$row.find( '.on-editing' ).removeClass( 'hidden' );
						$row.find( '.on-default' ).addClass( 'hidden' );
					},

					rowSetActionsDefault: function( $row ) {
						$row.find( '.on-editing' ).addClass( 'hidden' );
						$row.find( '.on-default' ).removeClass( 'hidden' );
					}

				};

				$(function() {
					EditableTable.initialize();
				});

			}).apply( this, [ jQuery ]);
		</script>
		<script th:inline="javascript">
			$(document).ready(function(){

				console.log("aaa")
				if([[${session.username}]]==null){
					window.location.replace("/user/login");

				}
			})

		</script>
	</body>
</html>